<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geography Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }
        #lobby-container, #game-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #4CAF50;
        }
        input, button {
            padding: 10px;
            font-size: 1em;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #prompt, #timer {
            font-size: 2em;
            margin: 10px 0;
            font-weight: bold;
        }
        #country-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 5px;
            text-align: left;
        }
        #country-list li {
            padding: 8px 15px;
            border-bottom: 1px solid #eee;
        }
        #country-list li:last-child {
            border-bottom: none;
        }
        #game-container {
            display: none;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
</head>
<body>
    <div id="lobby-container">
        <h1>Welcome to the Geography Game</h1>
        <div id="login-section">
            <p>
                <button onclick="loginWithFirebase()">Login with Email</button>
            </p>
        </div>
        <hr>
        <div id="game-options" style="display:none;">
            <h2>Game Lobby</h2>
            <div id="create-game">
                <h3>Start a New Game</h3>
                <button id="create-btn">Create Game</button>
            </div>
            <div id="join-game">
                <h3>Join a Game</h3>
                <input type="text" id="game-code-input" placeholder="Enter Game Code">
                <button id="join-btn">Join Game</button>
            </div>
        </div>
    </div>

    <div id="game-container">
        <h1>Geography Game</h1>
        <div id="prompt">Get Ready...</div>
        <div id="timer"></div>
        <div id="input-container">
            <input type="text" id="country-input" placeholder="Enter a country name...">
            <button id="submit-btn">Submit</button>
        </div>
        <div id="message"></div>
        <ul id="country-list"></ul>
    </div>

    <script>
        // YOUR FIREBASE CONFIG GOES HERE
        const firebaseConfig = {
            apiKey: "AIzaSyAEy_3vzbu0lvpB92zD3P6FcAgwmqQsfbU",
            authDomain: "freechat-30fd6.firebaseapp.com",
            projectId: "freechat-30fd6",
            storageBucket: "freechat-30fd6.appspot.com",
            messagingSenderId: "994973905020",
            appId: "1:994973905020:web:6ce7370a069a3cd2dd99f9",
            databaseURL: "https://freechat-30fd6-default-rtdb.firebaseio.com",
            measurementId: "G-9V8QZ106H0"
        };
        firebase.initializeApp(firebaseConfig);
        const rtdb = firebase.database();
        const auth = firebase.auth();

        // Game elements
        const lobbyContainer = document.getElementById('lobby-container');
        const gameContainer = document.getElementById('game-container');
        const promptEl = document.getElementById('prompt');
        const timerEl = document.getElementById('timer');
        const countryInput = document.getElementById('country-input');
        const submitBtn = document.getElementById('submit-btn');
        const messageEl = document.getElementById('message');
        const countryListEl = document.getElementById('country-list');

        // Game state variables
        let currentLetter;
        let currentContinentIndex = 0;
        let roundStartTime;
        let submittedThisRound = false;
        let gameCode;
        let currentPlayer;

        const continents = ['Africa', 'Asia', 'Australia', 'Europe', 'Central America', 'North America', 'South America', 'Oceania'];

        // Comprehensive list of countries and their continents
        const countries = {
            'Africa': {
                'A': ['Algeria', 'Angola'],
                'B': ['Benin', 'Botswana', 'Burkina Faso', 'Burundi'],
                'C': ['Cameroon', 'Cape Verde', 'Central African Republic', 'Chad', 'Comoros', 'CÃ´te d\'Ivoire', 'Ivory Coast'],
                'D': ['Democratic Republic of the Congo', 'Djibouti'],
                'E': ['Egypt', 'Equatorial Guinea', 'Eritrea', 'Eswatini', 'Ethiopia'],
                'G': ['Gabon', 'Gambia', 'Ghana', 'Guinea', 'Guinea-Bissau'],
                'K': ['Kenya'],
                'L': ['Lesotho', 'Liberia', 'Libya'],
                'M': ['Madagascar', 'Malawi', 'Mali', 'Mauritania', 'Mauritius', 'Morocco', 'Mozambique'],
                'N': ['Namibia', 'Niger', 'Nigeria'],
                'R': ['Republic of the Congo', 'Rwanda'],
                'S': ['Sao Tome and Principe', 'Senegal', 'Seychelles', 'Sierra Leone', 'Somalia', 'South Africa', 'South Sudan', 'Sudan'],
                'T': ['Tanzania', 'Togo', 'Tunisia'],
                'U': ['Uganda'],
                'Z': ['Zambia', 'Zimbabwe']
            },
            'Asia': {
                'A': ['Afghanistan', 'Armenia', 'Azerbaijan'],
                'B': ['Bahrain', 'Bangladesh', 'Bhutan', 'Brunei'],
                'C': ['Cambodia', 'China', 'Cyprus'],
                'G': ['Georgia'],
                'I': ['India', 'Indonesia', 'Iran', 'Iraq', 'Israel'],
                'J': ['Japan', 'Jordan'],
                'K': ['Kazakhstan', 'Kuwait', 'Kyrgyzstan'],
                'L': ['Laos', 'Lebanon'],
                'M': ['Malaysia', 'Maldives', 'Mongolia', 'Myanmar'],
                'N': ['Nepal', 'North Korea'],
                'P': ['Pakistan', 'Palestine', 'Philippines'],
                'Q': ['Qatar'],
                'R': ['Russia'],
                'S': ['Saudi Arabia', 'Singapore', 'South Korea', 'Sri Lanka', 'Syria'],
                'T': ['Taiwan', 'Tajikistan', 'Thailand', 'Timor-Leste', 'Turkey', 'Turkmenistan'],
                'U': ['United Arab Emirates', 'Uzbekistan'],
                'V': ['Vietnam']
            },
            'Australia': {
                'A': ['Australia']
            },
            'Europe': {
                'A': ['Albania', 'Andorra', 'Austria'],
                'B': ['Belarus', 'Belgium', 'Bosnia and Herzegovina', 'Bulgaria'],
                'C': ['Croatia', 'Czechia'],
                'D': ['Denmark'],
                'E': ['Estonia'],
                'F': ['Finland', 'France'],
                'G': ['Germany', 'Greece'],
                'H': ['Hungary'],
                'I': ['Iceland', 'Ireland', 'Italy'],
                'K': ['Kosovo'],
                'L': ['Latvia', 'Liechtenstein', 'Lithuania', 'Luxembourg'],
                'M': ['Malta', 'Moldova', 'Monaco', 'Montenegro'],
                'N': ['Netherlands', 'North Macedonia', 'Norway'],
                'P': ['Poland', 'Portugal'],
                'R': ['Romania', 'Russia'],
                'S': ['San Marino', 'Serbia', 'Slovakia', 'Slovenia', 'Spain', 'Sweden', 'Switzerland'],
                'U': ['Ukraine', 'United Kingdom'],
                'V': ['Vatican City']
            },
            'North America': {
                'C': ['Canada'],
                'M': ['Mexico'],
                'U': ['United States of America']
            },
            'South America': {
                'A': ['Argentina'],
                'B': ['Bolivia', 'Brazil'],
                'C': ['Chile', 'Colombia'],
                'E': ['Ecuador'],
                'G': ['Guyana'],
                'P': ['Paraguay', 'Peru'],
                'S': ['Suriname'],
                'U': ['Uruguay'],
                'V': ['Venezuela']
            },
            'Central America': {
                'B': ['Belize'],
                'C': ['Costa Rica'],
                'E': ['El Salvador'],
                'G': ['Guatemala'],
                'H': ['Honduras'],
                'N': ['Nicaragua'],
                'P': ['Panama']
            },
            'Oceania': {
                'A': ['Australia'],
                'F': ['Fiji'],
                'K': ['Kiribati'],
                'M': ['Marshall Islands', 'Micronesia'],
                'N': ['Nauru', 'New Zealand'],
                'P': ['Palau', 'Papua New Guinea'],
                'S': ['Samoa', 'Solomon Islands'],
                'T': ['Tonga', 'Tuvalu']
            }
        };

        const excludedLetters = ['X', 'O', 'W', 'Y', 'Z'];

        let allCountries = {};
        for (const continent in countries) {
            for (const letter in countries[continent]) {
                countries[continent][letter].forEach(country => {
                    allCountries[country.toLowerCase()] = true;
                });
            }
        }

        const usedCountries = {};
        
        // This is the main game logic
        function startGame(code) {
            gameCode = code;
            lobbyContainer.style.display = 'none';
            gameContainer.style.display = 'block';

            const gameRef = rtdb.ref(`games/${gameCode}`);

            // Listen for updates from Firebase to display submitted countries
            gameRef.child('submittedCountries').on('value', (snapshot) => {
                const data = snapshot.val();
                countryListEl.innerHTML = '';
                if (data) {
                    const submitted = Object.values(data);
                    submitted.sort((a, b) => a.country.localeCompare(b.country));
                    submitted.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.country} (Score: ${item.score}) - Submitted by ${item.name}`;
                        countryListEl.appendChild(li);
                        usedCountries[item.country.toLowerCase()] = true;
                    });
                }
            });

            startRound();
        }

        function startRound() {
            submittedThisRound = false;
            countryInput.value = '';
            countryInput.disabled = false;
            submitBtn.disabled = false;
            messageEl.textContent = '';
            
            const currentContinent = continents[currentContinentIndex];
            const validLetters = Object.keys(countries[currentContinent]).filter(l => !excludedLetters.includes(l));
            
            let letter;
            let hasValidCountry = false;
            do {
                const randomIndex = Math.floor(Math.random() * validLetters.length);
                letter = validLetters[randomIndex];
                const availableCountries = countries[currentContinent][letter].filter(c => !usedCountries[c.toLowerCase()]);
                hasValidCountry = availableCountries.length > 0;
            } while (!hasValidCountry && validLetters.length > 0);

            currentLetter = letter;
            
            promptEl.textContent = `Continent: ${currentContinent} | Letter: ${currentLetter}`;
            roundStartTime = Date.now();
            updateTimer();
        }

        function updateTimer() {
            const elapsed = ((Date.now() - roundStartTime) / 1000).toFixed(1);
            timerEl.textContent = `Elapsed Time: ${elapsed}s`;
            requestAnimationFrame(updateTimer);
        }

        submitBtn.addEventListener('click', () => {
            if (submittedThisRound) {
                messageEl.textContent = 'You have already submitted for this round.';
                return;
            }
            
            const submitted = countryInput.value.trim();
            const submittedLower = submitted.toLowerCase();
            const firstLetter = submitted.charAt(0).toUpperCase();

            const availableCountries = countries[continents[currentContinentIndex]][currentLetter].filter(c => !usedCountries[c.toLowerCase()]);
            if (submittedLower === 'none' && availableCountries.length === 0) {
                messageEl.textContent = 'Correct! You get bonus points for knowing there are no countries.';
                submittedThisRound = true;
                setTimeout(() => {
                    currentContinentIndex = (currentContinentIndex + 1) % continents.length;
                    startRound();
                }, 5000);
                return;
            }

            const isValid = (firstLetter === currentLetter) &&
                            (allCountries[submittedLower]) &&
                            (countries[continents[currentContinentIndex]][firstLetter] && countries[continents[currentContinentIndex]][firstLetter].some(c => c.toLowerCase() === submittedLower)) &&
                            (!usedCountries[submittedLower]);

            if (!isValid) {
                messageEl.textContent = 'Invalid submission. Try again.';
                return;
            }
            
            submittedThisRound = true;
            countryInput.disabled = true;
            submitBtn.disabled = true;

            const timeTaken = (Date.now() - roundStartTime) / 1000;
            const score = Math.max(100 - Math.floor(timeTaken * 10), 10);
            
            const submission = {
                country: submitted,
                score: score,
                time: timeTaken,
                name: currentPlayer.displayName
            };
            
            const gameRef = rtdb.ref(`games/${gameCode}`);
            gameRef.child('submittedCountries').push(submission);
            messageEl.textContent = `Submitted! Your score is: ${score}`;

            setTimeout(() => {
                currentContinentIndex = (currentContinentIndex + 1) % continents.length;
                startRound();
            }, 5000);
        });

        // Lobby Logic
        function loginWithFirebase() {
            // For this prototype, we'll just simulate a login
            currentPlayer = {
                uid: "player" + Math.floor(Math.random() * 10000),
                displayName: "Guest" + Math.floor(Math.random() * 1000)
            };
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('game-options').style.display = 'block';
        }

        document.getElementById('create-btn').addEventListener('click', () => {
            if (!currentPlayer) {
                alert("Please log in first.");
                return;
            }

            const gameCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            const gameRef = rtdb.ref('games/' + gameCode);
            gameRef.set({
                status: 'waiting',
                creator: currentPlayer.uid,
                players: {
                    [currentPlayer.uid]: {
                        name: currentPlayer.displayName,
                        score: 0
                    }
                }
            }).then(() => {
                startGame(gameCode);
            });
        });

        document.getElementById('join-btn').addEventListener('click', () => {
            const codeInput = document.getElementById('game-code-input').value.toUpperCase();
            if (!currentPlayer || !codeInput) {
                alert("Please log in and enter a game code.");
                return;
            }

            const gameRef = rtdb.ref('games/' + codeInput);
            gameRef.once('value', snapshot => {
                const gameData = snapshot.val();
                if (gameData && gameData.status === 'waiting') {
                    gameRef.child('players/' + currentPlayer.uid).set({
                        name: currentPlayer.displayName,
                        score: 0
                    }).then(() => {
                        startGame(codeInput);
                    });
                } else {
                    alert("Invalid or full game code.");
                }
            });
        });
    </script>
</body>
</html>
