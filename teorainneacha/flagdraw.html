<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flag Draw</title>
<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
}
#flagPrompt img {
    width: 200px;
    display: block;
    margin-bottom: 20px;
}
canvas {
    border: 2px solid black;
    cursor: crosshair;
    display: block;
    margin-bottom: 15px;
}
button {
    margin-right: 10px;
    padding: 10px 15px;
}
#result {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
}
</style>
</head>
<body>

<h1>Draw the Flag</h1>
<div id="flagPrompt"></div>
<canvas id="drawArea" width="500" height="300"></canvas>
<div>
    <button id="clearBtn">Clear</button>
    <button id="submitBtn">Submit Drawing</button>
</div>
<div id="result"></div>

<script>
(async function(){
    // Pick a random flag from bratai/countries.json
    const res = await fetch('bratai/countries.json');
    const countries = await res.json();
    const keys = Object.keys(countries);
    const randomKey = keys[Math.floor(Math.random() * keys.length)];
    const flagFile = countries[randomKey].flag;

    document.getElementById('flagPrompt').innerHTML =
        `<img src="bratai/${flagFile}" alt="Flag">`;

    const canvas = document.getElementById('drawArea');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    canvas.addEventListener('mousedown', () => drawing = true);
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseleave', () => drawing = false);

    canvas.addEventListener('mousemove', e => {
        if(!drawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        ctx.fillStyle = 'black';
        ctx.fillRect(x, y, 4, 4);
    });

    document.getElementById('clearBtn').onclick = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    document.getElementById('submitBtn').onclick = async () => {
        const dataURL = canvas.toDataURL('image/png');
        const response = await fetch('/api/main.py', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({flag: flagFile, drawing: dataURL})
        });
        const result = await response.json();
        document.getElementById('result').textContent =
            result.score ? `Accuracy Score: ${result.score}` : `Error: ${result.error}`;
    };
})();
</script>

</body>
</html>
