<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flag Draw</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    padding: 20px;
}

#flagPrompt img {
    width: 200px;
    display: block;
    margin-bottom: 20px;
}

canvas {
    border: 2px solid black;
    cursor: crosshair;
    display: block;
    margin-bottom: 15px;
}

.controls button {
    margin-right: 10px;
    padding: 10px 15px;
}

#result {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
}

    </style>
</head>
<body>

    <h1>Draw the Flag</h1>

    <!-- Where the correct flag appears for the player to copy -->
    <div id="flagPrompt"></div>

    <!-- Canvas for drawing -->
    <canvas id="drawArea" width="500" height="300"></canvas>

    <div class="controls">
        <button id="clearBtn">Clear</button>
        <button id="submitBtn">Submit Drawing</button>
    </div>

    <div id="result"></div>

    <script>// ------- LOAD A RANDOM FLAG -------
async function loadRandomFlag() {
    const res = await fetch('bratai/countries.json');
    const countries = await res.json();

    const keys = Object.keys(countries);
    const random = keys[Math.floor(Math.random() * keys.length)];
    const flagFile = countries[random].flag; // assume like "afghanistan.svg"

    document.getElementById('flagPrompt').innerHTML =
        `<img src="bratai/${flagFile}" alt="Flag">`;

    return flagFile;
}

let currentFlag = null;

// ------- CANVAS DRAWING SETUP -------
const canvas = document.getElementById('drawArea');
const ctx = canvas.getContext('2d');

let drawing = false;

canvas.addEventListener('mousedown', () => drawing = true);
canvas.addEventListener('mouseup', () => drawing = false);
canvas.addEventListener('mouseleave', () => drawing = false);

canvas.addEventListener('mousemove', e => {
    if (!drawing) return;

    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    ctx.fillStyle = 'black';
    ctx.fillRect(x, y, 4, 4);
});

// ------- CLEAR BUTTON -------
document.getElementById('clearBtn').onclick = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
};

// ------- SUBMIT BUTTON -------
document.getElementById('submitBtn').onclick = async () => {
    const imageData = canvas.toDataURL('image/png');

    const response = await fetch('/api/main.py', {
        method: 'POST',
        body: JSON.stringify({
            flag: currentFlag,
            drawing: imageData
        })
    });

    const result = await response.json();
    document.getElementById('result').textContent =
        `Accuracy Score: ${result.score}`;
};

// ------- INITIALISE -------
(async () => {
    currentFlag = await loadRandomFlag();
})();
</script>
</body>
</html>
